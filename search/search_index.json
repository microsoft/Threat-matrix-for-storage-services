{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Tactics","text":"Reconnaissance Initial Access Persistence Defense Evasion Credential Access Discovery Lateral Movement Exfiltration Impact Storage account discovery Valid SAS token Firewall and virtual networks configuration changes Firewall and virtual networks configuration changes Access key query Storage service discovery Malicious content upload Data transfer size limits Data corruption Search engines Valid shared key Role-based access control permission Role-based access control permission Cloud shell profiles Account configuration discovery Malware distribution Automated exfiltration Data manipulation Databases of publicly available storage accounts Authorized principal account Create SAS token Storage data clone Unsecured communication channel Trigger cross-service interaction Static website Data encryption for impact DNS/Passive DNS Anonymous public read access Container access level property Data transfer size limits Code injection Object replication Victim-owned websites SFTP Credentials SFTP account Automated exfiltration NFS Access Trusted Azure services Disable audit logs SMB Access Trusted access based on a managed identity Disable cloud workload protection Object replication Private endpoint Private endpoint Operations across geo replicas Disclaimer <p>The purpose of the threat matrix for storage services is to educate readers on the potential  tactics, techniques, and procedures (TTPs). It is not to teach how to weaponize or specifically abuse them.</p>"},{"location":"about/","title":"About","text":"<p>The purpose of the threat matrix for storage services is to conceptualize the known tactics, techniques, and procedures (TTP) that adversaries may use against this type accounts. Inspired from MITRE ATT&amp;CK, the threat matrix for storage services is designed to give quick insight into a potential TTP that an adversaries may be using in their attack campaign. </p> <p></p>"},{"location":"about/#acknowledgments","title":"Acknowledgments","text":"<p>The threat matrix for storage services is created by Evgeny Bogokovsky and Ram Pliskin of the Microsoft Defender for Cloud team. </p> <p>\u00a9 2023 The MITRE Corporation - This work is reproduced and distributed with the permission of The MITRE Corporation.</p>"},{"location":"tactics/CredentialAccess/","title":"Credential Access","text":"<p>Credential access consists of techniques for stealing credentials like account names and passwords. Using legitimate credentials can give adversaries access to other resources, make them harder to detect, and provide the opportunity to help achieve their goals.</p> ID Name MS-T818 Access key query MS-T834 Cloud shell profiles MS-T819 Unsecured communication channel"},{"location":"tactics/DefenseEvasion/","title":"Defense Evasion","text":"<p>The defense evasion tactic consists of techniques that are used by attackers to avoid detection and hide their malicious activity.</p> ID Name MS-T813 Firewall and virtual networks configuration changes MS-T808 Role-based access control permission MS-T841 Storage data clone MS-T831 Data transfer size limits MS-T832 Automated exfiltration MS-T810 Disable audit logs MS-T811 Disable cloud workload protection MS-T812 Private endpoint MS-T833 Operations across geo replicas"},{"location":"tactics/Discovery/","title":"Discovery","text":"<p>Discovery consists of techniques attackers may use to gain knowledge about the service. These techniques help attackers observe the environment and orient themselves before deciding how to act.</p> ID Name MS-T820 Storage service discovery MS-T835 Account configuration discovery"},{"location":"tactics/Exfiltration/","title":"Exfiltration","text":"<p>Exfiltration consists of techniques that attackers may use to extract data from storage accounts. These may include transferring data to another cloud storage outside of the victim account and may also include putting size limits on the transmission.  </p> ID Name MS-T831 Data transfer size limits MS-T832 Automated exfiltration MS-T836 Static website MS-T840 Object replication"},{"location":"tactics/Impact/","title":"Impact","text":"<p>Impact consists of techniques that adversaries use to disrupt availability or compromise integrity of your data</p> ID Name MS-T839 Data corruption MS-T838 Data encryption for impact (Ransomware) MS-T837 Data manipulation"},{"location":"tactics/InitialAccess/","title":"Initial Access","text":"<p>Initial access consists of techniques that use various entry vectors to gain their initial foothold on a storage account. Once achieved, initial access may allow for continued access, data exfiltration or lateral movement through malicious payload that is distributed to other resources.</p> ID Name MS-T814 Valid SAS token MS-T815 Valid shared key MS-T816 Authorized principal account MS-T817 Anonymous public read access MS-T825 SFTP credentials MS-T827 NFS access MS-T828 SMB access MS-T840 Object replication"},{"location":"tactics/LateralMovement/","title":"Lateral Movement","text":"<p>Lateral movement consists of techniques that adversaries use to increase their foothold in victim's environment.  Once they have access to a storage account, they can use it as a stepping stone to affect other resources which communicate with the same storage account. </p> ID Name MS-T821 Malicious content upload MS-T822 Malware distribution MS-T823 Trigger cross-service interaction MS-T824 Code injection"},{"location":"tactics/Persistence/","title":"Persistence","text":"<p>Persistence consists of techniques that attackers use to keep access to the storage account due to changed credentials, and other interruptions that could cut off their access. Techniques used for persistence include any access, action, or configuration changes that let them maintain their foothold on systems. </p> ID Name MS-T813 Firewall and virtual networks configuration changes MS-T808 Role-based access control permission MS-T806 Create SAS token MS-T807 Container access level property MS-T809 SFTP account MS-T830 Trusted Azure services MS-T829 Trusted access based on a managed identity MS-T812 Private endpoint"},{"location":"tactics/Reconnaissance/","title":"Reconnaissance","text":"<p>Reconnaissance consists of techniques that involve attackers actively or passively gathering information that can be used to support targeting.</p> ID Name MS-T801 Storage account discovery MS-T803 Databases of publicly available storage accounts MS-T804 Search engines MS-T820 DNS/Passive DNS MS-T805 Victim-owned websites"},{"location":"techniques/access-key-query/","title":"Access key query","text":"<p>Info</p> <p>ID: MS-T818 Tactic: Credential access  MITRE technique: T1528</p> <p>Attackers may leverage subscription/account-level access to gather storage account keys and use these keys to authenticate at the resource level. This technique exhibits cloud resource pivoting in combination with control management and data planes. Adversaries can query management APIs to fetch primary and secondary storage account keys.</p>"},{"location":"techniques/account-configuration-discovery/","title":"Account configuation discovery","text":"<p>Info</p> <p>ID: MS-T835 Tactic: Discovery  MITRE technique: </p> <p>Attackers may leverage control plane access permission to retrieve the storage account configuration. The configuration contains various technical details that may assist the attacker in implementing a variety of tactics. For example, firewall configuration provides network access information. Other parameters may reveal whether access operations are logged. The configuation may also contain the backup policy that may assist the attacker in performing data destruction. </p>"},{"location":"techniques/anonymous-public-read-access/","title":"Anonymous public read access","text":"<p>Info</p> <p>ID: MS-T817 Tactic: Initial access  MITRE technique: </p> <p>Attackers may leverage publicly exposed storage accounts to list containers/blobs and their properties. Azure Storage supports optional anonymous public read access for containers and blobs. By default, anonymous access to your data is never permitted. Unless you explicitly enable anonymous access, all requests to a container and its blobs must be authorized. When you configure a container's public access level setting to permit anonymous access, clients can read data in that container without authorizing the request.</p>"},{"location":"techniques/authorized-principal-account/","title":"Authorized principal account","text":"<p>Info</p> <p>ID: MS-T816 Tactic: Initial access  MITRE technique: T1078.004</p> <p>Attackers may steal account credentials using one of the credential access techniques or capture an account earlier in their reconnaissance process through social engineering to gain initial access. An authorized principal account can result in full control of storage account resources.</p>"},{"location":"techniques/automated-exfiltration/","title":"Automated exfiltration","text":"<p>Info</p> <p>ID: MS-T832 Tactic: Defense Evasion Exfiltration  MITRE technique: T1020</p> <p>Attackers may exploit legitimate automation processes, predefined by the compromised organization, with the goal of having their logging traces blend in normally within the company\u2019s typical activities. Assimilating or disguising malicious intentions will keep adversary actions, such as data theft, stealthier.</p>"},{"location":"techniques/cloud-shell-profiles/","title":"Cloud shell profiles","text":"<p>Info</p> <p>ID: MS-T834 Tactic: Credential access  MITRE technique:</p> <p>Cloud Shell is an interactive, authenticated, browser-accessible shell for managing cloud resources. It provides the flexibility of shell experience, either Bash or PowerShell. To support the Cloud Shell promise of being accessible from everywhere, Cloud Shell profiles and session history are saved on storage account. Attackers may leverage the legitimate use of Cloud Shell to impersonate account owners and potentially obtain additional secrets logged as part of session history.</p>"},{"location":"techniques/code-injection/","title":"Code injection","text":"<p>Info</p> <p>ID: MS-T824 Tactic: Lateral movement  MITRE technique: </p> <p>Benign code stored on a storage service may be tainted by adding malicious programs, scripts, or exploit code to otherwise valid files. Upon execution of the tainted code by a legitimate user, the malicious portion runs the adversary\u2019s code on a remote system. Attackers may use tainted code to move laterally from the executing host. Same is applicable for data blobs or files which may be eventually processed on a host by a legitimate application with software vulnerabilities. Attackers may tamper benign data with a payload that exploits a vulnerability on a user's end and execute a malicious code.</p>"},{"location":"techniques/container-access-level-property/","title":"Container access level property","text":"<p>Info</p> <p>ID: MS-T807 Tactic: Persistence  MITRE technique:</p> <p>Attackers may adjust the container access level property at the granularity of a blob or container, to permit anonymous read access to data in the storage account. This configuration secures a channel to exfiltrate data even if the initial access technique is no longer valid.</p>"},{"location":"techniques/create-sas-token/","title":"Create SAS token","text":"<p>Info</p> <p>ID: MS-T806 Tactic: Persistence  MITRE technique:</p> <p>Attackers may create a high-privileged SAS token with long expiry to preserve valid credentials for a long period. The tokens are not monitored by storage accounts thus they cannot be revoked (except Service SAS) and it's not easy to determine whether there are valid tokens in the wild until they are used.</p>"},{"location":"techniques/credential-scanning/","title":"Credential scanning","text":"<p>Info</p> <p>ID: MS-T836 Tactic: Credential access  MITRE technique: </p> <p>Attackers may go through storage resources search for common password storage locations to obtain user credentials. Passwords are stored in several places on a system, depending on the operating system or application holding the credentials. There are also specific applications that store passwords to make it easier for users manage and maintain. Once credentials are obtained, they can be used to perform lateral movement and access restricted information.</p>"},{"location":"techniques/data-corruption/","title":"Data corruption","text":"<p>Info</p> <p>ID: MS-T839 Tactic: Impact  MITRE technique: </p> <p>Attackers may corrupt or delete data stored on storage services to disrupt the availability of systems or other lines of business.</p>"},{"location":"techniques/data-encryption-for-impact/","title":"Data encryption for impact (Ransomware)","text":"<p>Info</p> <p>ID: MS-T838 Tactic: Impact  MITRE technique: T1486</p> <p>Attackers may encrypt data stored on storage services to disrupt the availability of systems or other lines of business. Making resources inaccessible by encrypting files or blobs and withholding access to a decryption key. This may be done to extract monetary compensation from a victim in exchange for decryption or a decryption key (ransomware).</p>"},{"location":"techniques/data-manipulation/","title":"Data manipulation","text":"<p>Info</p> <p>ID: MS-T837 Tactic: Impact  MITRE technique: T1565</p> <p>Attackers may insert or modify data in order to influence external outcomes, thus threatening the integrity of the data. By manipulating data, adversaries may attempt to affect a business process, organizational understanding, or decision making. The type of modification and the impact it will have depends on the target application and process as well as the goals and objectives of the adversary.</p>"},{"location":"techniques/data-transfer-size-limits/","title":"Data transfer size limits","text":"<p>Info</p> <p>ID: MS-T831 Tactic: Defense Evasion Exfiltration  MITRE technique: T1030</p> <p>Attackers may fragment stolen information and exfiltrate it on different size chunks to avoid being detected by triggering potentially predefined transfer threshold alerts.</p>"},{"location":"techniques/databases-of-public-accounts/","title":"Databases of publicly available storage accounts","text":"<p>Info</p> <p>ID: MS-T803 Tactic: Reconnaissance  MITRE technique: T1596</p> <p>Attackers may search public databases for publicly available storage accounts that can be used during targeting.</p>"},{"location":"techniques/disable-audit-logs/","title":"Disable audit logs","text":"<p>Info</p> <p>ID: MS-T810 Tactic: Defense Evasion  MITRE technique: T1562.008</p> <p>Attackers may disable storage account audit logs to prevent event tracking and avoid detection. Audit logs provide a detailed record of operations performed on a target storage account and may be used to detect malicious activities. Thus, disabling these logs can leave a resource vulnerable to attacks without being detected.</p>"},{"location":"techniques/disable-protection-service/","title":"Disable cloud workload protection","text":"<p>Info</p> <p>ID: MS-T811 Tactic: Defense Evasion  MITRE technique: </p> <p>Attackers may disable the cloud workload protection service which raises security alerts upon detection of malicious activities in cloud storage services. </p>"},{"location":"techniques/dns-passive-dns/","title":"DNS/Passive DNS","text":"<p>Info</p> <p>ID: MS-T826 Tactic: Reconnaissance  MITRE technique: T1596.001</p> <p>Attackers may search for DNS data for valid storage account names that can become potential targets. Threat actors can query nameservers using brute-force technique to enumerate existing storage accounts in the wild, or search through centralized repositories of logged DNS query responses (known as passive DNS).</p>"},{"location":"techniques/firewall-configuration-changes/","title":"Firewall and virtual networks configuration changes","text":"<p>Info</p> <p>ID: MS-T813 Tactic: Defense Evasion Persistence  MITRE technique: T1562.007</p> <p>Attackers may disable firewall protection or set additional firewall rules to masquerade their access channel.  Azure Storage offers a set of built-in network access features. Administrators can leverage these capabilities to restrict access to storage resources. Restriction rules can operate at the IP level or VNet IDs. When network rules are configured, only requests originated from authorized subnets will be served. </p>"},{"location":"techniques/malicious-content-upload/","title":"Malicious content upload","text":"<p>Info</p> <p>ID: MS-T821 Tactic: Lateral movement  MITRE technique: </p> <p>Attackers may use storage services to store a malicious program or toolset that will be executed at later times during their operation. In addition, adversaries may exploit the trust between users and their organization\u2019s Storage services by storing phishing content. Furthermore, storage services can be leveraged to park gathered intelligence that will be exfiltrated when terms suit the actor group.</p>"},{"location":"techniques/malware-distribution/","title":"Malware distribution","text":"<p>Info</p> <p>ID: MS-T822 Tactic: Lateral movement  MITRE technique: </p> <p>Storage services offer different types of mechanisms to support auto-synchronization between various resources and the storage account. Attackers may leverage access to the storage account to upload malware and benefit from the auto-sync built-in capabilities to have their payload being populated and potentially weaponize multiple systems.</p>"},{"location":"techniques/nfs-access/","title":"NFS access","text":"<p>Info</p> <p>ID: MS-T827 Tactic: InitialAcess  MITRE technique:</p> <p>Attackers may perform initial access to a storage account using NFS protocol where enabled. While access is restricted to a list of allowed virtual networks that are configured on the storage account firewall, connection via NFS protocol does not require authentication and can be performed by any source on the specified networks.</p>"},{"location":"techniques/object-replication/","title":"Object replication","text":"<p>Info</p> <p>ID: MS-T840 Tactic: Persistence Exfiltration  MITRE technique: T1537</p> <p>Attackers may set a replication policy between source and destination containers that asynchronously copies objects from source to destination. This feature can be maliciously misused in both directions. Outbound replication can serve as an exfiltration channel of customer data from the victim's container to an adversary's container. Inbound replication can be used to deliver malware from an adversary's container to a victim's container. After the policy is set, the attacker can operate on their container without accessing the victim container.</p>"},{"location":"techniques/operations-across-geo-replicas/","title":"Operations across geo replicas","text":"<p>Info</p> <p>ID: MS-T833 Tactic: Defense Evasion  MITRE technique:</p> <p>Attackers may split their requests across geo replicas to reduce the footprint in each region and avoid being detected by various rules and heuristics.</p>"},{"location":"techniques/private-endpoint/","title":"Private endpoint","text":"<p>Info</p> <p>ID: MS-T812 Tactic: Defense Evasion Persistence  MITRE technique: </p> <p>Attackers may set private endpoints for a storage account to establish a separate communication channel from a target virtual network. The new endpoint is assigned with a private IP address within the virtual network's address range. All the requests sent to the private endpoint bypass the storage account firewall by design.</p>"},{"location":"techniques/rbac-permission/","title":"Role-based access control permission","text":"<p>Info</p> <p>ID: MS-T808 Tactic: Defense Evasion Persistence  MITRE technique: T1098.001</p> <p>Storage services offer built-in RBAC roles that encompass sets of permissions used to access different data types. Definition of custom roles is also supported. Upon assignment of an RBAC role to an identity object (like Azure AD security principal) the storage provider grants access to that security principal. Attackers may leverage the RBAC mechanism to ensure persistent access to their owned identity objects.</p>"},{"location":"techniques/search-engines/","title":"Search engines","text":"<p>Info</p> <p>ID: MS-T804 Tactic: Reconnaissance  MITRE technique: T1593.002</p> <p>Attackers may use search engines to collect information about victim storage accounts that can be used during targeting. Search engine services typical crawl online sites to index context and may provide users with specialized syntax to search for specific keywords such as storage accounts domain names (site:*.blob.core.windows.net)</p>"},{"location":"techniques/sftp-account/","title":"SFTP account","text":"<p>Info</p> <p>ID: MS-T809 Tactic: Persistence  MITRE technique:</p> <p>Attackers may create an SFTP account to maintain access to a target storage account. The SFTP account is local on the storage instance and is not subject to Azure RBAC permissions. The account is also unaffected in case of storage account access keys rotation.</p>"},{"location":"techniques/sftp-credentials/","title":"SFTP credentials","text":"<p>Info</p> <p>ID: MS-T825 Tactic: InitialAcess  MITRE technique:</p> <p>Attackers may obtain and abuse credentials of an SFTP account as a means of gaining initial access. SFTP is a prevalent file transfer protocol between a client and a remote service. Once the user connects to the cloud storage service, the user can upload and download blobs and perform other operations that are supported by the protocol. SFTP connection requires SFTP accounts which are managed locally in the storage service instance, including credentials in a form of passwords or key-pairs.</p>"},{"location":"techniques/smb-access/","title":"SMB access","text":"<p>Info</p> <p>ID: MS-T828 Tactic: InitialAcess  MITRE technique:</p> <p>Attackers may perform initial access to a storage account file shares using Server Message Block (SMB) protocol.</p>"},{"location":"techniques/static-website/","title":"Static website","text":"<p>Info</p> <p>ID: MS-T836 Tactic: Exfiltration  MITRE technique:</p> <p>Attackers may use the \"static website\" feature to exfiltrate collected data outside of the storage account. Static website is a cloud storage provider hosting capability that enables serving static web content directly from the storage account. The website can be reached via an alternative web endpoint which might be overlooked when restricting access to the storage account.</p>"},{"location":"techniques/storage-account-discovery/","title":"Storage account discovery","text":"<p>Info</p> <p>ID: MS-T801 Tactic: Reconnaissance  MITRE technique: T1595</p> <p>Attackers may execute active reconnaissance scans to gather storage account names that becomes a potential target. Active scans are those where the adversary probes victim infrastructure via network traffic, as opposed to other forms of reconnaissance that do not involve direct interaction.</p>"},{"location":"techniques/storage-data-clone/","title":"Storage data clone","text":"<p>Info</p> <p>ID: MS-T841 Tactic: Defense Evasion  MITRE technique:</p> <p>Storage services offer different types of cloning or backup data stored on them. Attackers may abuse these built-in capabilities to steal sensitive documents, source code, credentials, and other business crucial information.</p>"},{"location":"techniques/storage-service-discovery/","title":"Storage service discovery","text":"<p>Info</p> <p>ID: MS-T820 Tactic: Discovery  MITRE technique: </p> <p>Attackers may leverage access permission to explore the stored objects in the storage account. Tools witnessed, at the reconnaissance phase, are oftentimes used toward this post-compromise information-gathering objective, now with authorization to access storage APIs, such as the List Blobs call.</p>"},{"location":"techniques/trigger-cross-service-interaction/","title":"Trigger cross-service interaction","text":"<p>Info</p> <p>ID: MS-T823 Tactic: Lateral movement  MITRE technique: </p> <p>Attackers may manipulate storage services to trigger a compute service, like Azure Functions, where an attacker already has a foothold on a storage container and can inject a blob that will initiate a chain of a compute process. This may allow an attacker to infiltrate another resource and cause harm.</p>"},{"location":"techniques/trusted-access-managed-identity/","title":"Trusted access based on a managed identity","text":"<p>Info</p> <p>ID: MS-T829 Tactic: Persistence  MITRE technique:</p> <p>Attackers may configure the storage account firewall to allow access by specific resource instances based on their system-assigned managed identity, regardless of their source address. The resource type can be chosen from a predefined list provided by Azure Storage, and the resource instance must be in the same tenant as the storage account. The RBAC permissions of the resource instance determine the types of operations that a resource instance can perform on storage account data.</p>"},{"location":"techniques/trusted-azure-services/","title":"Trusted Azure services","text":"<p>Info</p> <p>ID: MS-T830 Tactic: Persistence  MITRE technique:</p> <p>Attackers may configure the storage account firewall to allow access by trusted Azure services. Azure Storage provides a predefined list of trusted services. Any resource from that list that belongs to the same subscription as the storage account is allowed by the firewall even if there is no firewall rule that explicitly permits the source address of the resource.</p>"},{"location":"techniques/unsecured-communication-channel/","title":"Unsecured communication channel","text":"<p>Info</p> <p>ID: MS-T819 Tactic: Credential access  MITRE technique: T1040</p> <p>Attackers may sniff network traffic and capture credentials sent over an insecure protocol. When Storage account is configured to support unencrypted protocol such as HTTP, credentials are passed over the wire unprotected and are susceptible to leakage. The attacker can use the compromised credentials to gain initial access to the storage account. </p>"},{"location":"techniques/valid-sas-token/","title":"Valid SAS token","text":"<p>Info</p> <p>ID: MS-T814 Tactic: Initial access  MITRE technique: </p> <p>A shared access signature (SAS) is a token, that is appended to the a uniform resource identifier (URI) for a storage resource, that grants restricted access rights over the associated resource in your storage account. Attackers may get a SAS token using one of the Credential Access techniques or during the reconnaissance process through social engineering.</p>"},{"location":"techniques/valid-shared-key/","title":"Valid shared key","text":"<p>Info</p> <p>ID: MS-T815 Tactic: Initial access  MITRE technique: </p> <p>Attackers may get a shared key using one of Credential Access techniques or capture one earlier in their reconnaissance process through social engineering to gain initial access. Adversaries may leverage keys left in source code or configuration files. Sophisticated attackers may also obtain keys from hosts (virtual machines) that have mounted File Share on their system (SMB).  Shared key provides unrestricted permissions over all data plane operations.</p>"},{"location":"techniques/victim-owned-websites/","title":"Victim-owned websites","text":"<p>Info</p> <p>ID: MS-T805 Tactic: Reconnaissance  MITRE technique: T1594</p> <p>Attackers may look for storage accounts of a victim enterprise by searching its websites. Victim-owned website pages may be stored on a storage account or contain links to retrieve data stored in a storage account. The links contain the URL of the storage and provide an entry point into the account.</p>"}]}